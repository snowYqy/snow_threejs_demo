# 2D 户型编辑规则文档（智能家居版）

## 🎯 目标
保证 Room 可识别、设备可绑定、3D 可生成，而不是建筑施工精度。

---

## L1 — 结构可用性规则（Hard Rules）
❌ 不满足 = 禁止进入 3D / 禁止配置设备

### ✅ L1-1 墙体封闭性（必做）
- [x] 至少存在 1 个闭合墙体区域（Room）
- [x] 闭合区域面积 ≥ 最小阈值（1㎡ = 10000cm²）
- [x] 闭合路径中无断点校验

**校验方式：** 墙体构建图结构检测 Cycle，计算多边形面积

### ✅ L1-2 墙体合法性
- [x] 墙长度 ≥ 最小长度（30cm）
- [x] 墙体不允许自交
- [x] 墙体端点必须连接到 0 或 ≥2 条墙

### ✅ L1-3 门/窗依附墙体
- [x] 每个门/窗必须绑定 wallId
- [x] 门/窗中心点在线段投影范围内
- [x] 门/窗宽度 < 所属墙长度

### ✅ L1-4 单位与坐标一致性
- [x] 全局统一单位（cm）
- [x] 不允许混合单位
- [x] 原点、坐标系定义一致

---

## L2 — 空间语义规则（Smart Home Core）
⚠️ 不影响绘制，但直接影响设备、自动化、3D

### ✅ L2-1 Room 语义完整性
- [x] 每个 Room 有唯一 ID
- [x] Room 边界为闭合多边形
- [x] Room 面积可计算

### ✅ L2-2 Room 不重叠
- [x] 任意两个 Room 不存在重叠面积
- [x] 允许共享边界（共墙）

### ⏳ L2-3 设备绑定规则（待实现）
- [ ] 设备必须绑定 Room 或 Wall
- [ ] 设备不能绑定多个 Room
- [ ] 设备必须位于绑定对象范围内

### ⏳ L2-4 可见性与可达性（待实现）
- [ ] 所有设备在 2D 中可见
- [ ] 不允许设备悬空（不属于任何 Room / Wall）

---

## L3 — 体验优化规则（Soft Rules）
✅ 自动修复 > 报错 ❌ 不阻塞流程

### ✅ L3-1 自动吸附（强烈推荐）
- [x] 墙端点接近时自动吸附（15px）
- [x] 门/窗靠近墙边自动贴合

### ✅ L3-2 自动闭合修复
- [x] 闭合差值 < 阈值时自动补齐（20px）
- [x] 不弹错误提示

### ✅ L3-3 Room 自动重算
- [x] 增删墙后自动重算 Room
- [x] 合并/拆分 Room 自动更新

### ✅ L3-4 门窗纠偏
- [x] 门/窗靠近墙端点时自动滑动
- [x] 防止跨墙端点

---

## L4 — 智能家居行业增强规则（推荐）
🧠 非必需，但非常加分

### ✅ L4-1 默认 Room 类型推断（可选）
- [x] 基于面积/门数推断 Room 类型
- [x] AI/规则均可
- [x] 允许用户修改

### ⏳ L4-2 默认设备位置建议（不强制）
- [ ] 灯居中
- [ ] 门锁靠门
- [ ] 窗帘沿窗

---

## ❌ 明确不做的规则

以下规则**明确不在本编辑器的范围内**：

1. **不校验建筑规范**
   - 不检查承重墙、剪力墙等结构要求
   - 不检查防火分区、疏散通道等消防规范
   - 不检查采光、通风等建筑规范

2. **不校验装修尺寸**
   - 不检查门洞高度是否符合标准
   - 不检查窗户离地高度
   - 不检查走廊宽度是否符合规范

3. **不做施工级精度**
   - 不要求毫米级精度
   - 不检查墙体厚度是否符合实际
   - 不考虑施工误差

4. **不做家具摆放规范**
   - 不检查家具尺寸是否合理
   - 不检查家具摆放是否符合人体工程学
   - 不检查家具与墙体的距离

---

## 配置常量

```typescript
export const EDITOR_CONFIG = {
  // L1 规则阈值
  MIN_ROOM_AREA: 10000,      // 最小房间面积 1㎡ = 10000 cm²
  MIN_WALL_LENGTH: 30,       // 最小墙长度 30cm
  
  // L3 自动修复阈值
  SNAP_DISTANCE: 15,         // 自动吸附距离 15px
  AUTO_CLOSE_THRESHOLD: 20,  // 自动闭合阈值 20px
  DOOR_WINDOW_MIN_DISTANCE: 20, // 门窗距墙端点最小距离
  
  // 单位
  UNIT: 'cm',                // 全局单位
  PIXELS_PER_CM: 1,          // 1像素 = 1cm
};
```

---

## 房间类型推断规则

| 面积范围 | 门数 | 推断类型 |
|---------|------|---------|
| < 4㎡ | 0 | 储物间 |
| < 4㎡ | ≥1 | 卫生间 |
| 4-8㎡ | - | 卧室 |
| 8-15㎡ | <2 | 卧室 |
| 8-15㎡ | ≥2 | 客厅 |
| ≥15㎡ | - | 客厅 |
